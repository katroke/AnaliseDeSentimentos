<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Sentimentos com IA</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='1.5' stroke='%2300DC82' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M12 1a4 4 0 0 1 4 4v2.5a1.5 1.5 0 0 0 1.5 1.5a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1 -1.5 1.5a1.5 1.5 0 0 0 -1.5 1.5v2.5a4 4 0 1 1 -8 0v-2.5a1.5 1.5 0 0 0 -1.5 -1.5a1.5 1.5 0 0 1 -1.5 -1.5v-3a1.5 1.5 0 0 1 1.5 -1.5a1.5 1.5 0 0 0 1.5 -1.5v-2.5a4 4 0 0 1 4 -4z' /%3E%3Cpath d='M16.5 13a2.5 2.5 0 1 0 0 -5a2.5 2.5 0 0 0 0 5z' /%3E%3Cpath d='M4.5 13a2.5 2.5 0 1 1 0 -5a2.5 2.5 0 0 1 0 5z' /%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        :root {
            --cor-fundo-app: #1F222B;
            --cor-painel-lateral: #242832;
            --cor-card: #2C303A;
            --cor-borda: #3A3F4C;
            --cor-borda-foco: #535A6B;
            --cor-acento-verde: #00DC82;
            --cor-acento-verde-hover: #33e39b;
            --cor-texto-principal: #F5F5F5;
            --cor-texto-secundario: #A0A5B5;
            --cor-texto-subtitulo: #7A8092;
            --sombra-card: 0px 8px 16px rgba(0, 0, 0, 0.1), 0px 4px 8px rgba(0, 0, 0, 0.2);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%; overflow: hidden; font-family: 'Inter', sans-serif;
            background-color: var(--cor-fundo-app); color: var(--cor-texto-principal);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .app-container { display: flex; height: 100vh; }
        .sidebar {
            width: 280px; background-color: var(--cor-painel-lateral);
            border-right: 1px solid var(--cor-borda); display: flex; flex-direction: column;
            transition: width 0.3s ease;
        }
        .sidebar-header { padding: 16px; border-bottom: 1px solid var(--cor-borda); }
        #new-analysis-btn {
            width: 100%; background-color: transparent; border: 1px solid var(--cor-borda);
            color: var(--cor-texto-principal); border-radius: 8px; padding: 10px 12px;
            font-size: 0.95em; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 10px;
            transition: all 0.2s ease-in-out;
        }
        #new-analysis-btn:hover { border-color: var(--cor-acento-verde); color: var(--cor-acento-verde); background-color: rgba(0, 220, 130, 0.05); }
        #new-analysis-btn svg { stroke: currentColor; transition: transform 0.3s ease; }
        #new-analysis-btn:hover svg { transform: rotate(90deg); }
        .sidebar-subheader { padding: 20px 20px 10px 20px; font-weight: 600; color: var(--cor-texto-subtitulo); font-size: 0.8em; text-transform: uppercase; letter-spacing: 0.5px; }
        #history-list { list-style: none; overflow-y: auto; flex-grow: 1; scrollbar-width: thin; }
        .history-item {
            padding: 12px 20px; cursor: pointer; transition: all 0.2s ease;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            color: var(--cor-texto-secundario); border-left: 3px solid transparent; font-size: 0.9em;
        }
        .history-item:hover { background-color: var(--cor-card); color: var(--cor-texto-principal); }
        .history-item.active {
            background-color: var(--cor-card); color: var(--cor-texto-principal);
            font-weight: 500; border-left-color: var(--cor-acento-verde);
        }
        .sidebar-footer {
            padding: 10px 16px;
            margin-top: auto;
            border-top: 1px solid var(--cor-borda);
        }
        #clear-history-btn {
            width: 100%;
            background-color: transparent;
            border: 1px solid transparent;
            color: var(--cor-texto-subtitulo);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease-in-out;
        }
        #clear-history-btn:hover {
            color: #e74c3c;
            background-color: rgba(231, 76, 60, 0.1);
        }
        #clear-history-btn svg {
            stroke: currentColor;
        }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; }
        .response-area { flex-grow: 1; overflow-y: auto; padding: 40px; }
        #welcome-message { text-align: center; padding-top: 10vh; color: var(--cor-texto-secundario); max-width: 700px; margin: 0 auto;}
        .welcome-logo {
            width: 70px; height: 70px; margin: 0 auto 25px auto;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--cor-acento-verde), #008a52);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 220, 130, 0.2);
            transform: rotate(-30deg);
        }
        .welcome-logo svg { width: 32px; height: 32px; stroke: white; transform: rotate(30deg); }
        #welcome-message h1 { color: var(--cor-texto-principal); margin-bottom: 10px; font-weight: 600; font-size: 2.2em; }
        #welcome-message p { max-width: 450px; margin: 0 auto 30px auto; line-height: 1.6; }
        .example-prompts { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left;}
        .prompt-card {
            background-color: var(--cor-card);
            padding: 15px; border-radius: 10px; border: 1px solid var(--cor-borda);
            cursor: pointer; transition: all 0.2s ease-in-out;
        }
        .prompt-card:hover { transform: translateY(-5px); border-color: var(--cor-borda-foco); box-shadow: var(--sombra-card); }
        .prompt-card .title { font-weight: 500; margin-bottom: 5px; color: var(--cor-texto-principal); }
        .prompt-card .description { font-size: 0.85em; color: var(--cor-texto-subtitulo); }
        .analysis-header {
            display: flex; align-items: center; gap: 20px;
            margin-bottom: 30px; padding-bottom: 25px; border-bottom: 1px solid var(--cor-borda);
        }
        .sentiment-emoji-main { font-size: 48px; line-height: 1; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }
        .analysis-summary h2 { font-size: 2em; font-weight: 600; margin-bottom: 5px; }
        .analysis-summary p { font-size: 1.1em; color: var(--cor-texto-secundario); font-style: italic; }
        .analysis-section { background-color: var(--cor-card); border-radius: 12px; padding: 25px; margin-bottom: 20px; border: 1px solid var(--cor-borda); box-shadow: var(--sombra-card);}
        .titulo-campo { font-weight: 600; font-size: 1.1em; margin-bottom: 20px; color: var(--cor-texto-principal); display: flex; align-items: center; gap: 10px;}
        .titulo-campo svg { stroke: var(--cor-texto-subtitulo); }
        .sentimentos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .sentimento-card {
            background-color: var(--cor-fundo-app); border: 1px solid var(--cor-borda);
            border-radius: 10px; padding: 20px; text-align: center;
            transition: all 0.2s ease-in-out;
        }
        .sentimento-card:hover { transform: translateY(-3px); border-color: var(--cor-borda-foco); }
        .sentiment-emoji { font-size: 32px; margin-bottom: 10px; }
        .sentimento-card .nome { font-weight: 500; margin-bottom: 10px; font-size: 1.05em; }
        .sentimento-descricao { font-size: 0.85em; color: var(--cor-texto-secundario); margin-bottom: 15px; min-height: 40px; flex-grow: 1; }
        .intensity-bar-bg { height: 8px; background-color: var(--cor-borda); border-radius: 4px; overflow: hidden; margin-top: auto; }
        .intensity-bar-fg { height: 100%; border-radius: 4px; transition: width 0.5s ease-in-out; }
        .analysis-section p { font-size: 1em; line-height: 1.7; color: var(--cor-texto-secundario); }
        .analysis-content > * { opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
        .analysis-content > *.visible { opacity: 1; transform: translateY(0); }
        .input-area { padding: 20px; border-top: 1px solid var(--cor-borda); background-color: var(--cor-fundo-app); }
        #sentiment-form { display: flex; align-items: center; gap: 15px; max-width: 800px; margin: 0 auto; position: relative; }
        textarea {
            flex-grow: 1; padding: 14px 20px; border: 1px solid var(--cor-borda); border-radius: 10px;
            background-color: var(--cor-card); color: var(--cor-texto-principal); resize: none;
            height: 52px; font-family: 'Inter', sans-serif; font-size: 1em; transition: all 0.3s ease;
        }
        textarea:focus { outline: none; border-color: var(--cor-acento-verde); background-color: #333640; box-shadow: 0 0 0 3px rgba(0, 220, 130, 0.15); }
        button[type="submit"] {
            padding: 12px; width: 50px; height: 50px; border: none; border-radius: 10px;
            background-color: var(--cor-acento-verde); color: white;
            cursor: pointer; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
        }
        button[type="submit"]:hover { background-color: var(--cor-acento-verde-hover); transform: scale(1.05); }
        button:disabled { background-color: #555; color: #888; cursor: not-allowed; transform: none; }
        #loading-indicator { display: flex; align-items: center; gap: 15px; color: var(--cor-texto-secundario); }
        .loader {
            height: 24px; width: 24px;
            border: 3px solid var(--cor-borda); 
            border-top-color: var(--cor-acento-verde);
            border-radius: 50%; 
            animation: spin 1s linear infinite;
        }
        .hidden { display: none; }
        #loading-indicator.hidden {
            display: none;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--cor-card);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--cor-borda);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        .modal-content h3 {
            color: var(--cor-texto-principal);
            font-size: 1.4em;
            margin-bottom: 15px;
        }
        .modal-content p {
            color: var(--cor-texto-secundario);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-secondary {
            background-color: var(--cor-borda);
            color: var(--cor-texto-principal);
        }
        .btn-secondary:hover {
            background-color: var(--cor-borda-foco);
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <button id="new-analysis-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Nova An√°lise
                </button>
            </div>
            <div class="sidebar-subheader">Recentes</div>
            <ul id="history-list"></ul>
            <div class="sidebar-footer">
                <button id="clear-history-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    Limpar Hist√≥rico
                </button>
            </div>
        </aside>
        <main class="main-content">
            <div class="response-area" id="response-area">
                <div id="welcome-message">
                    <div class="welcome-logo">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 1a4 4 0 0 1 4 4v2.5a1.5 1.5 0 0 0 1.5 1.5a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1 -1.5 1.5a1.5 1.5 0 0 0 -1.5 1.5v2.5a4 4 0 1 1 -8 0v-2.5a1.5 1.5 0 0 0 -1.5 -1.5a1.5 1.5 0 0 1 -1.5 -1.5v-3a1.5 1.5 0 0 1 1.5 -1.5a1.5 1.5 0 0 0 1.5 -1.5v-2.5a4 4 0 0 1 4 -4z" stroke-width="1.5"/></svg>
                    </div>
                    <h1>Analisador de Sentimentos</h1>
                    <p>Entenda emo√ß√µes, inten√ß√µes e o tom por tr√°s de qualquer texto. Insira uma frase abaixo para come√ßar.</p>
                    <div class="example-prompts">
                        <div class="prompt-card" data-prompt="O atendimento ao cliente foi excepcional, resolveram meu problema rapidamente!">
                            <div class="title">Feedback Positivo</div>
                            <div class="description">Analisar um elogio de cliente.</div>
                        </div>
                        <div class="prompt-card" data-prompt="Estou um pouco decepcionado com a qualidade do produto, n√£o era o que eu esperava.">
                            <div class="title">Cr√≠tica Construtiva</div>
                            <div class="description">Analisar uma reclama√ß√£o ou feedback negativo.</div>
                        </div>
                        <div class="prompt-card" data-prompt="A reuni√£o foi adiada para a pr√≥xima sexta-feira.">
                            <div class="title">Frase Neutra</div>
                            <div class="description">Analisar uma comunica√ß√£o informativa.</div>
                        </div>
                        <div class="prompt-card" data-prompt="Que filme incr√≠vel! Superou todas as minhas expectativas, estou sem palavras!">
                            <div class="title">Review de Produto</div>
                            <div class="description">Analisar uma avalia√ß√£o entusiasmada.</div>
                        </div>
                    </div>
                </div>
                <div id="response-display" class="hidden"></div>
            </div>
            <div class="input-area">
                <form id="sentiment-form">
                    <textarea id="frase-input" name="frase" rows="1" placeholder="Digite ou cole o texto aqui..." required></textarea>
                    <button type="submit" id="submit-button" title="Analisar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                    <div id="loading-indicator" class="hidden">
                        <div class="loader"></div>
                        <span>A IA est√° processando...</span>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <div id="confirm-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3>Confirmar Exclus√£o</h3>
            <p>Tem certeza de que deseja apagar todo o hist√≥rico? Esta a√ß√£o n√£o pode ser desfeita.</p>
            <div class="modal-actions">
                <button id="cancel-delete-btn" class="modal-btn btn-secondary">Cancelar</button>
                <button id="confirm-delete-btn" class="modal-btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

<script>
$(document).ready(function() {
    let history = [];
    let activeHistoryId = null;

    const sentimentEmojis = {
        positivo: 'üòä', negativo: 'üòû', neutro: 'üòê', alegria: 'üòÑ', tristeza: 'üò¢',
        raiva: 'üò†', surpresa: 'üòÆ', medo: 'üò®', confian√ßa: 'üôÇ', otimismo: 'üëç',
        decep√ß√£o: 'üíî', default: 'ü§î'
    };
    const welcomeScreen = $("#welcome-message");
    const responseDisplay = $("#response-display");
    const historyList = $("#history-list");
    const fraseInput = $("#frase-input");
    const confirmModal = $("#confirm-modal");

    // A linha confirmModal.hide() foi removida daqui, pois o estilo inline j√° faz o trabalho.

    function loadHistory() {
        const storedHistory = localStorage.getItem('sentimentAnalysisHistory');
        history = storedHistory ? JSON.parse(storedHistory) : [];
        renderHistoryList();
    }
    function saveHistory() {
        localStorage.setItem('sentimentAnalysisHistory', JSON.stringify(history));
    }

    function renderHistoryList() {
        historyList.empty();
        history.forEach(item => {
            const phraseText = item && item.frase ? item.frase : 'An√°lise inv√°lida';
            const truncatedPhrase = phraseText.length > 25 ? phraseText.substring(0, 25) + '...' : phraseText;
            const listItem = $(`<li class="history-item" data-id="${item.id}">${truncatedPhrase}</li>`);
            if (item.id === activeHistoryId) listItem.addClass('active');
            historyList.append(listItem);
        });
    }

    function resetToWelcomeState() {
        welcomeScreen.removeClass('hidden');
        responseDisplay.addClass('hidden').empty();
        activeHistoryId = null;
        fraseInput.val('');
        renderHistoryList();
    }
    
    function getProgressColor(value) {
        if (value <= 33) return 'linear-gradient(90deg, #e74c3c, #c0392b)';
        if (value <= 66) return 'linear-gradient(90deg, #f1c40f, #f39c12)';
        return 'linear-gradient(90deg, #2ecc71, #27ae60)';
    }

    function displayAnalysis(analysisData) {
        if (!analysisData) return;
        welcomeScreen.addClass('hidden');
        
        const capitalize = (text) => text ? text.charAt(0).toUpperCase() + text.slice(1) : '';
        const classe = analysisData.classe ? analysisData.classe.toLowerCase() : 'neutro';
        
        const renderSentimentosGrid = (sentimentos) => {
            if (!sentimentos || Object.keys(sentimentos).length === 0) {
                return '<p>Nenhum sentimento espec√≠fico detectado.</p>';
            }
            return Object.entries(sentimentos).map(([key, value]) => {
                let intensidade = 0;
                let descricao = 'Descri√ß√£o n√£o fornecida.';
                if (typeof value === 'object' && value !== null && value.hasOwnProperty('intensidade')) {
                    intensidade = value.intensidade || 0;
                    descricao = value.descricao || 'Descri√ß√£o n√£o fornecida.';
                } else if (typeof value === 'number') {
                    intensidade = value;
                }
                const barColor = getProgressColor(intensidade);
                const emoji = sentimentEmojis[key.toLowerCase()] || sentimentEmojis.default;
                return `
                <div class="sentimento-card">
                    <div class="sentiment-emoji">${emoji}</div>
                    <div class="nome">${capitalize(key)}</div>
                    <p class="sentimento-descricao">${descricao}</p>
                    <div class="intensity-bar-bg">
                        <div class="intensity-bar-fg" style="width: ${intensidade}%; background: ${barColor};"></div>
                    </div>
                </div>`;
            }).join('');
        };
        
        const responseHtml = `
            <div class="analysis-content">
                <div class="analysis-header">
                    <div class="sentiment-emoji-main">${sentimentEmojis[classe] || sentimentEmojis.neutro}</div>
                    <div class="analysis-summary">
                        <h2>${capitalize(classe)}</h2>
                        <p>"${analysisData.frase || 'Frase n√£o encontrada na resposta.'}"</p>
                    </div>
                </div>
                <div class="analysis-section">
                    <h3 class="titulo-campo">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8V16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Sentimentos Detalhados
                    </h3>
                    <div class="sentimentos-grid">${renderSentimentosGrid(analysisData.sentimentos)}</div>
                </div>
                <div class="analysis-section">
                    <h3 class="titulo-campo">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5C21 16.7467 16.7467 21 11.5 21C6.25329 21 2 16.7467 2 11.5C2 6.25329 6.25329 2 11.5 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 22L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M11.5 6V11.5L15 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Resposta Recomendada
                    </h3>
                    <p>${analysisData.resposta_recomendada || 'N/A'}</p>
                </div>
                <div class="analysis-section">
                    <h3 class="titulo-campo">
                       <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Explica√ß√£o do Modelo
                    </h3>
                    <p>${analysisData.explicacao_modelo || 'N/A'}</p>
                </div>
            </div>`;

        responseDisplay.html(responseHtml).removeClass('hidden');
        
        const contentElements = responseDisplay.find('.analysis-content > *');
        
        contentElements.each(function(index) {
            setTimeout(() => { $(this).addClass('visible'); }, index * 100);
        });

        $('#response-area').scrollTop(0);
    }
    
    function submitAnalysis(frase) {
        if (!frase || fraseInput.prop('disabled')) return;

        const submitButton = $("#submit-button");
        const loadingIndicator = $("#loading-indicator");

        submitButton.addClass('hidden');
        loadingIndicator.removeClass('hidden');
        fraseInput.prop('disabled', true);

        $.post("/analyse", { frase: frase })
            .done(function(data) {
                if (data.error) {
                    alert("Erro retornado pela an√°lise: " + data.error);
                    return;
                }
                const newAnalysis = { ...data, frase: frase, id: new Date().getTime() };
                history.unshift(newAnalysis);
                activeHistoryId = newAnalysis.id;
                saveHistory();
                renderHistoryList();
                displayAnalysis(newAnalysis);
                fraseInput.val('').css('height', '52px');
            })
            .fail(function(jqXHR) {
                let errorMsg = "Erro de comunica√ß√£o com o servidor.";
                if (jqXHR.responseJSON && jqXHR.responseJSON.error) {
                    errorMsg = "Erro no servidor: " + jqXHR.responseJSON.error;
                }
                alert(errorMsg);
            })
            .always(function() {
                loadingIndicator.addClass('hidden');
                submitButton.removeClass('hidden');
                fraseInput.prop('disabled', false).focus();
            });
    }

    $("#sentiment-form").on('submit', function(event) {
        event.preventDefault();
        const frase = fraseInput.val().trim();
        submitAnalysis(frase);
    });

    historyList.on('click', '.history-item', function() {
        const itemId = $(this).data('id');
        const foundItem = history.find(item => item.id === itemId);
        if (foundItem) {
            activeHistoryId = itemId;
            displayAnalysis(foundItem); 
            renderHistoryList();
        }
    });

    $("#new-analysis-btn").on('click', function() {
        resetToWelcomeState();
    });
    
    $(".prompt-card").on('click', function() {
        const promptText = $(this).data('prompt');
        fraseInput.val(promptText);
        submitAnalysis(promptText);
    });

    fraseInput.on('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });

    fraseInput.on('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            $("#sentiment-form").submit();
        }
    });

    $("#clear-history-btn").on('click', function() {
        if (history.length > 0) {
            confirmModal.show();
        }
    });

    $(document).on('click', '#cancel-delete-btn', function() {
        confirmModal.hide();
    });

    $(document).on('click', '#confirm-delete-btn', function() {
        history = [];
        saveHistory();
        resetToWelcomeState();
        confirmModal.hide();
    });
    
    confirmModal.on('click', function(event) {
        if (event.target === this) {
            confirmModal.hide();
        }
    });

    loadHistory();
});
</script>
</body>
</html>
